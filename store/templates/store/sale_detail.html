{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load math_filters %}

{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'store/sales.css' %}">

<a href="{% url 'list_sales' %}" class="back-link">&rarr; العودة إلى قائمة المبيعات</a>
<p><strong>رقم عملية البيع :</strong> {{ sale.id }}</p>
<p><strong>تاريخ عملية البيع :</strong> {{ sale.date|date:"Y/m/d"  }}</p>



<table class="sales-detail-table">
    <thead>
        <tr>
            <th>المادة</th>
            <th>الكمية المباعة</th>
            <th> سعر الوحدة بعد الربح</th>
            <th>سعر الصرف وقت المبيع SYP</th>
            <th>إجمالي السعر $</th>
            <th>إجمالي السعر SYP</th>
        </tr>
    </thead>
    <tbody>
        {% for item in sale_items %}
        <tr>
            <td>{{ item.product.name }}</td>
            <td>
                {% if item.product.is_weight %}
                {{ item.quantity|div:1000|floatformat:3 }} Kg
                {% else %}
                {{ item.quantity }}
                {% endif %}
            </td>
            <td>{{ item.price_per_item }}</td>
            <td>{{ item.dollar_rate_at_sale|floatformat:0|intcomma }}</td>
            <td>{{ item.total_price }}</td>
            <td>{{ item.total_syp_price|floatformat:0|intcomma }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td colspan="4" style="text-align:center">المجموع</td>
            <td>{{all_items_price}}</td>
            <td>{{all_items_price_syp|floatformat:0|intcomma}} = <strong>{{total_payable_syp|floatformat:0|intcomma}}</strong></td>
        </tr>
    </tbody>
</table>

<button type="button" class="btn red" id="open-delete-modal">حذف عملية البيع</button>
<button class="btn green">
    <a href={% url 'print_receipt' sale.id %}>
        طباعة الفاتورة
    </a>
</button>
<div id="delete-modal" class="modal">
    <div class="modal-content">
        <p>هل تريد حذف عملية البيع ؟</p>
        <div class="modal-actions">
            <a id="confirm-delete" href="{% url 'remove_sale' sale.id %}">
                <button class="btn red">حذف</button>
            </a>
            <button type="button" class="btn gray" id="cancel-delete">إلغاء</button>
        </div>
    </div>
</div>


<script>
    // Delete Confirmation Modal Logic
    const modal = document.getElementById('delete-modal');
    const openBtn = document.getElementById('open-delete-modal');
    const cancelBtn = document.getElementById('cancel-delete');

    // Add event listener to the single delete button
    openBtn.addEventListener('click', () => {
        modal.style.display = 'block';
    });

    // Cancel button event
    cancelBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // Close modal when clicking outside
    window.addEventListener('click', (event) => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
</script>

{% endblock %}